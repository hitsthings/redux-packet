{"version":3,"file":"redux-packet.dev.js","sources":["../src/pack.js","../src/consume.js"],"sourcesContent":["import { bindActionCreators } from \"redux\";\n\n/*\n//usage of pack\npackAll({\n    fromContext: {\n        selector: (state, contextA, contextB) => `itemsInContext`, // or a function returning this to make one selector per component for caching purposes\n        actions: (contextA, contextB) => `actionsForContext`,\n    }\n})\nconst users = packAll({\n    fromGroup: {\n        selector: () => createStructuredSelector({\n            users: usersForGroupSelector,\n            usersLoading: usersLoadingForGroupSelector,\n            usersAllLoaded: usersAllLoadedForGroupSelector,\n            usersLoadingErrors: usersLoadingErrorsForGroupSelector,\n        }),\n        actions: (dispatch, group) => ({\n            loadUsers: () => dispatch(loadUsersForGroup(group)),\n            addUserToGroup: user => dispatch(addUserToGroup(user, group)),\n        }), // OR a raw object like actions: { actionA: actionCreatorA, actionB: actionCreatorB }\n    },\n    byPermission: { ... }\n})\n*/\n\nconst memoizeFirstMapStateToProps = (selector, executeContextSelectors, firstState, firstProps, firstValue, firstContext) => {\n    if (executeContextSelectors) {\n        let inner = (state, props) => {\n            inner = (state, props) => selector(state, ...executeContextSelectors(props));\n            if (props !== firstProps) { // nothing salvageable\n                return inner(state, props); \n            }\n            if (state !== firstState) { \n                return selector(state, ...firstContext); // same props, can memoize contexts\n            }\n            return firstValue;// same props and state, can return first value\n        };\n        return (state, props) => inner(state, props);\n    }\n    let inner = state => {\n        inner = selector;\n        return state === firstState ?\n            firstValue :\n            inner(state);\n    };\n    return state => inner(state);\n};\n\nconst checkPacketDescriptor = (packetDescriptor, name, calledFnName, argExpectation) => {\n    if (typeof packetDescriptor !== 'object' || packetDescriptor === null) {\n        throw new TypeError(`${calledFnName} expects ${argExpectation}an object, but ${name} was not.`);\n    }\n    if (packetDescriptor.selector && typeof packetDescriptor.selector !== 'function') {\n        throw new TypeError(`${calledFnName} expects selector to be a function, but ${name}.selector was not.`);\n    }\n    if (packetDescriptor.actions && (typeof packetDescriptor.actions !== 'function' && typeof packetDescriptor.actions !== 'object')) {\n        throw new TypeError(`${calledFnName} expects actions to be a function or object, but ${name}.actions was not.`);\n    }\n    if (!packetDescriptor.selector && !packetDescriptor.actions) {\n        throw new TypeError(`${calledFnName} expects either selector or actions to be present, but ${name} had neither.`);\n    }\n};\n\nconst checkPacketMapAndGetNames = packetMap => {\n    if (typeof packetMap !== 'object' || packetMap === null) {\n        throw new TypeError('packAll(packetMap) expects packetMap to be an object.');\n    }\n    if (Array.isArray(packetMap)) {\n        throw new TypeError('packAll(packetMap) expects packetMap to be an object, not an Array.');\n    }\n    const packetNames = Object.keys(packetMap);\n    if (packetNames.length === 0) {\n        throw new TypeError('packAll(packetMap) expected to receive an object with properties, but found no properties.')\n    }\n    return packetNames;\n};\n\nconst selectorExecutor = selectors => {\n    selectors = selectors.map(selector => typeof selector === 'function' ? selector : () => selector);\n    return props => selectors.map(selector => selector(props));\n};\n\nconst internalPack = (packetDescriptor, name) => {\n    const PacketMaker = (...contextSelectors) => {\n        const hasContext = contextSelectors.length !== 0;\n        const executeContextSelectors = hasContext && selectorExecutor(contextSelectors);\n        if ('minimumSelectorsExpected' in packetDescriptor && contextSelectors.length < packetDescriptor.minimumSelectorsExpected) {\n            const expected = packetDescriptor.minimumSelectorsExpected;\n            throw new Error(`The packet ${name} expects at least ${expected} ${expected === 1 ? 'selector' : 'selectors'} to be provided.`);\n        }\n        const mapStateToProps = packetDescriptor.selector ? (firstState, firstProps) => {\n            const firstContext = hasContext ? executeContextSelectors(firstProps) : [];\n            let firstValue = packetDescriptor.selector(firstState, ...firstContext);\n            if (typeof firstValue !== 'function') { // no factory, fully memoized first call\n                return memoizeFirstMapStateToProps(packetDescriptor.selector, executeContextSelectors, firstState, firstProps, firstValue, firstContext);\n            }\n            if (hasContext) { // factory, but memoize first context if we can. Passing in a new object as firstState means we'll never return a memoized firstValue\n                return memoizeFirstMapStateToProps(firstValue, executeContextSelectors, {}, firstProps, null, firstContext);\n            }\n            // factory, no context, no memoization\n            return state => firstValue(state);\n        } : null;\n        const mapDispatchToProps = typeof packetDescriptor.actions === 'function' ?\n            hasContext ?\n                (dispatch, props) => packetDescriptor.actions(dispatch, ...executeContextSelectors(props)) :\n                dispatch => packetDescriptor.actions(dispatch) :\n                packetDescriptor.actions ?\n                dispatch => bindActionCreators(packetDescriptor.actions, dispatch) :\n                null;\n        return {\n            mapStateToProps,\n            mapDispatchToProps,\n        };\n    };\n    if (name) {\n        Object.defineProperty(PacketMaker, 'name', {\n            writable: false,\n            enumerable: false,\n            configurable: true,\n            value: `PacketMaker(${name})`\n        });\n    }\n    return PacketMaker;\n};\n\nexport const pack = (packetDescriptor, name) => {\n    checkPacketDescriptor(packetDescriptor, \"packetDescriptor\", \"pack(packetDescriptor)\", \"\");\n    return internalPack(packetDescriptor, name);\n};\n\nexport const packAll = packetMap => {\n    const packetNames = checkPacketMapAndGetNames(packetMap);\n    return packetNames.reduce((o,name) => {\n        const packetDescriptor = packetMap[name];\n        checkPacketDescriptor(packetDescriptor, `packetMap['${name}']`, \"packAll(packetMap)\", \"each property to be \");\n        o[name] = internalPack(packetDescriptor, name);\n        return o;\n    }, {});\n};","import { bindActionCreators } from \"redux\";\nimport { connect } from 'react-redux';\n\n/*\n//usage of consume\nconsume([\n    users.fromGroup(props => props.group),\n    cards.fromProject(props => props.project, props => props.filterTerm),\n])(({ users = [], usersLoading, usersAllLoaded, usersLoadingErrors, cards, cardsLoading, cardsLoadingErrors, loadUsers, addUserToGroup}) => (\n    <div>\n        <button disabled={usersLoading || usersLoadingErrors} onClick={usersLoading || usersLoadingErrors ? null : loadUsers}>\n            Load users\n        </button>\n        {users.map(user => (\n            <p key={user.id}>{user.name}</p>\n        ))}\n    </div>\n))\n*/\nconst concatKeys = (arr, obj) => arr.concat(Object.keys(obj));\nconst nonUniqueFilter = (value, i, values) => values.lastIndexOf(value) !== i;\nconst defaultMapPacketsToProps = (...values) => {\n    const nonUniqueProps = values.reduce(concatKeys,[]).filter(nonUniqueFilter);\n    if (nonUniqueProps.length) {\n        throw new Error(\"Props are not unique. \" +\n            \"Pass in mapPacketsToProps to deduplicate them. \" +\n            \"Duplicate names: \" + nonUniqueProps.join(','));\n    }\n    return Object.assign({}, ...values);\n};\nconst defaultMergeProps = (packetProps, ownProps) => ({\n    ...ownProps,\n    ...packetProps\n})\n\nconst noop = (a) => {};\nconst usesContext = fn => typeof fn === 'function' && (fn.dependsOnOwnProps == null ? fn.length !== 1 : Boolean(fn.dependsOnOwnProps));\nconst stateUsesContext = packet => usesContext(packet.mapStateToProps);\n\nexport const makeMergePropsOnePacket = (mapPacketsToProps, mergeProps) => {\n    if (!mapPacketsToProps) {\n        if (!mergeProps) {\n            return undefined;\n        }\n        return (stateProps, dispatchProps, ownProps) => mergeProps(\n            {\n                ...stateProps,\n                ...dispatchProps\n            },\n            ownProps\n        );\n    }\n    if (!mergeProps) {\n        return (stateProps, dispatchProps, ownProps) => ({\n            ...ownProps,\n            ...mapPacketsToProps({\n                ...stateProps,\n                ...dispatchProps\n            })\n        });\n    }\n    return (stateProps, dispatchProps, ownProps) => mergeProps(\n        mapPacketsToProps({\n            ...stateProps,\n            ...dispatchProps\n        }),\n        ownProps\n    );\n};\n\nexport const consumeOnePacket = (\n    packet,\n    mapPacketsToProps,\n    mergeProps,\n    options\n) => connect(\n    packet.mapStateToProps || undefined,\n    packet.mapDispatchToProps || undefined,\n    makeMergePropsOnePacket(mapPacketsToProps, mergeProps),\n    options\n);\n\nconst mapAllToPackets = mappers => {\n    const anyContext = mappers.filter(Boolean).some(usesContext);\n    return anyContext\n        ? (stateOrDispatch, props) => ({\n            packets: mappers.map(mapper => mapper(stateOrDispatch, props))\n        })\n        : stateOrDispatch => ({\n            packets: mappers.map(mapper => mapper(stateOrDispatch))\n        });\n};\n\nexport const makeMapStateToProps = (packets, withState) =>\n    (withState.length || undefined) && (\n        withState.some(stateUsesContext)\n            ? (state, props) => mapAllToPackets(packets.map(b => b.mapStateToProps ? b.mapStateToProps(state, props) : noop))\n            : state => mapAllToPackets(packets.map(b => b.mapStateToProps ? b.mapStateToProps(state) : noop))\n    );\n\nexport const makeMapDispatchToProps = (packets, withDispatch) =>\n    (withDispatch.length || undefined) && (\n        mapAllToPackets(packets.map(packet =>\n            packet.mapDispatchToProps\n                ? typeof packet.mapDispatchToProps === 'function'\n                    ? packet.mapDispatchToProps\n                    : dispatch => bindActionCreators(packet.mapDispatchToProps, dispatch)\n                : noop\n        ))\n    );\n\nexport const makeMergeProps = (mapPacketsToProps, mergeProps) => {\n    if (!mapPacketsToProps) {\n        mapPacketsToProps = defaultMapPacketsToProps;\n    }\n    if (!mergeProps) {\n        mergeProps = defaultMergeProps;\n    }\n    return (stateProps, dispatchProps, ownProps) => {\n        const propsByPacket = stateProps.packets.map((packetState, i) => {\n            const packetDispatch = dispatchProps.packets[i];\n            return {\n                ...packetState,\n                ...packetDispatch\n            };\n        });\n        const packetProps = mapPacketsToProps(...propsByPacket);\n        return mergeProps(packetProps, ownProps);\n    };\n};\n\nexport const consumeMultiplePackets = (\n    packets,\n    mapPacketsToProps,\n    mergeProps,\n    options\n) => connect(\n    makeMapStateToProps(packets, packets.filter(b => b.mapStateToProps)),\n    makeMapDispatchToProps(packets, packets.filter(b => b.mapDispatchToProps)),\n    makeMergeProps(mapPacketsToProps, mergeProps),\n    options\n);\n\nexport const consume = (\n    packets,\n    mapPacketsToProps,\n    mergeProps,\n    options\n) => {\n    if (packets && (packets.mapStateToProps || packets.mapDispatchToProps)) {\n        packets = [packets];\n    }\n    if (!Array.isArray(packets) || packets.length === 0) {\n        throw new TypeError('At least one packet must be passed to consume()')\n    }\n\n    if (packets.length === 1) {\n        return consumeOnePacket(packets[0], mapPacketsToProps, mergeProps, options);\n    }\n    return consumeMultiplePackets(packets, mapPacketsToProps, mergeProps, options);\n};\n"],"names":["memoizeFirstMapStateToProps","selector","executeContextSelectors","firstState","firstProps","firstValue","firstContext","inner","state","props","checkPacketDescriptor","packetDescriptor","name","calledFnName","argExpectation","TypeError","actions","checkPacketMapAndGetNames","packetMap","Array","isArray","packetNames","Object","keys","length","selectorExecutor","selectors","map","internalPack","PacketMaker","contextSelectors","hasContext","minimumSelectorsExpected","expected","Error","mapStateToProps","mapDispatchToProps","dispatch","bindActionCreators","defineProperty","writable","enumerable","configurable","value","pack","packAll","reduce","o","concatKeys","arr","obj","concat","nonUniqueFilter","i","values","lastIndexOf","defaultMapPacketsToProps","nonUniqueProps","filter","join","assign","defaultMergeProps","packetProps","ownProps","noop","a","usesContext","fn","dependsOnOwnProps","Boolean","stateUsesContext","packet","makeMergePropsOnePacket","mapPacketsToProps","mergeProps","undefined","stateProps","dispatchProps","consumeOnePacket","options","connect","mapAllToPackets","mappers","anyContext","some","stateOrDispatch","packets","mapper","makeMapStateToProps","withState","b","makeMapDispatchToProps","withDispatch","makeMergeProps","propsByPacket","packetState","packetDispatch","consumeMultiplePackets","consume"],"mappings":"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"}