{"version":3,"file":"redux-packet.dev.js","sources":["../src/pack.js","../src/consume.js"],"sourcesContent":["import { bindActionCreators } from \"redux\";\n\n/*\n//usage of pack\npackAll({\n    fromContext: {\n        selector: (state, contextA, contextB) => `itemsInContext`, // or a function returning this to make one per component\n        actions: (contextA, contextB) => `actionsForContext`,\n    }\n})\nconst users = pack({\n    fromGroup: {\n        selector: () => createStructuredSelector({\n            users: usersForGroupSelector,\n            usersLoading: usersLoadingForGroupSelector,\n            usersAllLoaded: usersAllLoadedForGroupSelector,\n            usersLoadingErrors: usersLoadingErrorsForGroupSelector,\n        }),\n        actions: (dispatch, group) => ({\n            loadUsers: () => dispatch(loadUsersForGroup(group)),\n            addUserToGroup: user => dispatch(addUserToGroup(user, group)),\n        }), // OR a raw object like actions: { actionA: actionCreatorA, actionB: actionCreatorB }\n    },\n    byPermission: { ... }\n})\n*/\n\nconst memoizeFirstMapStateToProps = (selector, executeContextSelectors, firstState, firstProps, firstValue, firstContext) => {\n    if (executeContextSelectors) {\n        let inner = (state, props) => {\n            inner = (state, props) => selector(state, ...executeContextSelectors(props));\n            if (props !== firstProps) { // nothing salvageable\n                return inner(state, props); \n            }\n            if (state !== firstState) { \n                return selector(state, ...firstContext); // same props, can memoize contexts\n            }\n            return firstValue;// same props and state, can return first value\n        };\n        return (state, props) => inner(state, props);\n    }\n    let inner = state => {\n        inner = selector;\n        return state === firstState ?\n            firstValue :\n            inner(state);\n    };\n    return state => inner(state);\n};\n\nconst checkPacketDescriptor = (packetDescriptor, name, calledFnName, argExpectation) => {\n    if (typeof packetDescriptor !== 'object' || packetDescriptor === null) {\n        throw new TypeError(`${calledFnName} expects ${argExpectation}an object, but ${name} was not.`);\n    }\n    if (packetDescriptor.selector && typeof packetDescriptor.selector !== 'function') {\n        throw new TypeError(`${calledFnName} expects selector to be a function, but ${name}.selector was not.`);\n    }\n    if (packetDescriptor.actions && (typeof packetDescriptor.actions !== 'function' && typeof packetDescriptor.actions !== 'object')) {\n        throw new TypeError(`${calledFnName} expects actions to be a function or object, but ${name}.actions was not.`);\n    }\n};\n\nconst checkPacketMapAndGetNames = packetMap => {\n    if (typeof packetMap !== 'object' || packetMap === null) {\n        throw new TypeError('packAll(packetMap) expects packetMap to be an object.');\n    }\n    if (Array.isArray(packetMap)) {\n        throw new TypeError('packAll(packetMap) expects packetMap to be an object, not an Array.');\n    }\n    const packetNames = Object.keys(packetMap);\n    if (packetNames.length === 0) {\n        throw new TypeError('packAll(packetMap) expected to receive an object with properties, but found no properties.')\n    }\n    return packetNames;\n};\n\nconst selectorExecutor = selectors => {\n    selectors = selectors.map(selector => typeof selector === 'function' ? selector : () => selector);\n    return props => selectors.map(selector => selector(props));\n};\n\nconst internalPack = (packetDescriptor, name) => {\n    const PacketMaker = (...contextSelectors) => {\n        const hasContext = contextSelectors.length !== 0;\n        const executeContextSelectors = hasContext && selectorExecutor(contextSelectors);\n        if ('minimumSelectorsExpected' in packetDescriptor && contextSelectors.length < packetDescriptor.minimumSelectorsExpected) {\n            throw new Error(`The packet ${name} expects at least ${packetDescriptor.minimumSelectorsExpected} selectors to be provided.`);\n        }\n        const mapStateToProps = packetDescriptor.selector ? (firstState, firstProps) => {\n            const firstContext = hasContext ? executeContextSelectors(firstProps) : [];\n            let firstValue = packetDescriptor.selector(firstState, ...firstContext);\n            if (typeof firstValue !== 'function') { // no factory, fully memoized first call\n                return memoizeFirstMapStateToProps(packetDescriptor.selector, executeContextSelectors, firstState, firstProps, firstValue, firstContext);\n            }\n            if (hasContext) { // factory, but memoize first context if we can. Passing in a new object as firstState means we'll never return a memoized firstValue\n                return memoizeFirstMapStateToProps(firstValue, executeContextSelectors, {}, firstProps, null, firstContext);\n            }\n            // factory, no context, no memoization\n            return state => firstValue(state);\n        } : null;\n        const mapDispatchToProps = typeof packetDescriptor.actions === 'function' ?\n            hasContext ?\n                (dispatch, props) => packetDescriptor.actions(dispatch, ...executeContextSelectors(props)) :\n                dispatch => packetDescriptor.actions(dispatch) :\n                packetDescriptor.actions ?\n                dispatch => bindActionCreators(packetDescriptor.actions, dispatch) :\n                null;\n        return {\n            mapStateToProps,\n            mapDispatchToProps,\n        };\n    };\n    if (name) {\n        Object.defineProperty(PacketMaker, 'name', {\n            writable: false,\n            enumerable: false,\n            configurable: true,\n            value: `PacketMaker(${name})`\n        });\n    }\n    return PacketMaker;\n};\n\nexport const pack = (packetDescriptor, name) => {\n    checkPacketDescriptor(packetDescriptor, \"packetDescriptor\", \"pack(packetDescriptor)\", \"\");\n    return internalPack(packetDescriptor, name);\n};\n\nexport const packAll = packetMap => {\n    const packetNames = checkPacketMapAndGetNames(packetMap);\n    return packetNames.reduce((o,name) => {\n        const packetDescriptor = packetMap[name];\n        checkPacketDescriptor(packetDescriptor, `packetMap['${name}']`, \"packAll(packetMap)\", \"each property to be \");\n        o[name] = internalPack(packetDescriptor, name);\n        return o;\n    }, {});\n};","import { bindActionCreators } from \"redux\";\nimport { connect } from 'react-redux';\n\n/*\n//usage of component\ncomponent([\n    users.fromGroup(props => props.group),\n    cards.fromProject(props => props.project, props => props.filterTerm),\n])(({ users = [], usersLoading, usersAllLoaded, usersLoadingErrors, cards, cardsLoading, cardsLoadingErrors, loadUsers, addUserToGroup}) => (\n    <div>\n        <button disabled={usersLoading || usersLoadingErrors} onClick={usersLoading || usersLoadingErrors ? null : loadUsers}>\n            Load users\n        </button>\n        {users.map(user => (\n            <p key={user.id}>{user.name}</p>\n        ))}\n    </div>\n))\n*/\nconst uniqueFilter = (value, i, values) => values.lastIndexOf(value) === i;\nconst nonUniqueFilter = (value, i, values) => values.lastIndexOf(value) !== i;\nconst spreadAllSafe = fallbackName => (...values) => {\n    const nonUniqueProps = values.reduce((a, v) => a.concat(Object.keys(v)),[]).filter(nonUniqueFilter);\n    if (nonUniqueProps.length) {\n        throw new Error(\"Props are not unique. \" +\n            \"Pass in \" + fallbackName + \" to deduplicate them. \" +\n            \"Duplicate names: \" + nonUniqueProps.join(','));\n    }\n    return Object.assign({}, ...values);\n};\nconst defaultMapPacketsToProps = spreadAllSafe(\"mapPacketsToProps\");\nconst defaultMergeProps = (packetProps, ownProps) => ({\n    ...packetProps,\n    ...ownProps\n})\n\nconst noop = () => {};\n\nconst anyContext = (packets, prop) => packets.some(b => typeof b[prop] === 'function' && b[prop].length !== 1);\n\nexport const makeMergePropsOnePacket = (mapPacketsToProps, mergeProps) => {\n    if (!mapPacketsToProps) {\n        if (!mergeProps) {\n            return undefined;\n        }\n        return (stateProps, dispatchProps, ownProps) => mergeProps(\n            {\n                ...stateProps,\n                ...dispatchProps\n            },\n            ownProps\n        );\n    }\n    if (!mergeProps) {\n        return (stateProps, dispatchProps, ownProps) => ({\n            ...mapPacketsToProps({\n                ...stateProps,\n                ...dispatchProps\n            }),\n            ...ownProps\n        });\n    }\n    return (stateProps, dispatchProps, ownProps) => mergeProps(\n        mapPacketsToProps({\n            ...stateProps,\n            ...dispatchProps\n        }),\n        ownProps\n    );\n};\n\nexport const consumeOnePacket = (\n    packet,\n    mapPacketsToProps,\n    mergeProps,\n    options\n) => connect(\n    packet.mapStateToProps || undefined,\n    packet.mapDispatchToProps || undefined,\n    makeMergePropsOnePacket(mapPacketsToProps, mergeProps),\n    options\n);\n\nexport const makeMapStateToProps = (packets, withState) =>\n    (withState.length || undefined) && (\n        anyContext(withState, 'mapStateToProps')\n            ? (state, props) => {\n                const mapStateToPropsList = packets\n                    .map(b => b.mapStateToProps ? b.mapStateToProps(state, props) : noop);\n                return (state, props) => ({\n                    packets: mapStateToPropsList.map(mapper => mapper(state, props))\n                });\n            }\n            : state => {\n                const mapStateToPropsList = packets\n                    .map(b => b.mapStateToProps ? b.mapStateToProps(state) : noop);\n                return state => ({\n                    packets: mapStateToPropsList.map(mapper => mapper(state))\n                });\n            }\n    );\n\nexport const makeMapDispatchToProps = (packets, withDispatch) =>\n    (withDispatch.length || undefined) && (\n        anyContext(withDispatch, 'mapDispatchToProps')\n            ? (dispatch, props) => ({\n                packets: packets.map(b =>\n                    b.mapDispatchToProps\n                        ? typeof b.mapDispatchToProps === 'function'\n                            ? b.mapDispatchToProps(dispatch, props)\n                            : bindActionCreators(b.mapDispatchToProps, dispatch)\n                        : undefined\n                )\n            })\n            : (dispatch) => ({\n                packets: packets.map(b =>\n                    b.mapDispatchToProps\n                        ? typeof b.mapDispatchToProps === 'function'\n                            ? b.mapDispatchToProps(dispatch)\n                            : bindActionCreators(b.mapDispatchToProps, dispatch)\n                        : undefined\n                )\n            })\n    );\n\nexport const makeMergeProps = (mapPacketsToProps, mergeProps) => {\n    if (!mapPacketsToProps) {\n        mapPacketsToProps = defaultMapPacketsToProps;\n    }\n    if (!mergeProps) {\n        mergeProps = defaultMergeProps;\n    }\n    return (stateProps, dispatchProps, ownProps) => {\n        const propsByPacket = stateProps.packets.map((packetState, i) => {\n            const packetDispatch = dispatchProps.packets[i];\n            return {\n                ...packetState,\n                ...packetDispatch\n            };\n        });\n        const packetProps = mapPacketsToProps(...propsByPacket);\n        return mergeProps(packetProps, ownProps);\n    };\n};\n\nexport const consume = (\n    packets,\n    mapPacketsToProps,\n    mergeProps,\n    options\n) => {\n    if (packets && (packets.mapStateToProps || packets.mapDispatchToProps)) {\n        packets = [packets];\n    }\n    if (!Array.isArray(packets) || packets.length === 0) {\n        throw new TypeError('At least one packets must be passed to component()')\n    }\n\n    if (packets.length === 1) return consumeOnePacket(packets[0], mapPacketsToProps, mergeProps, options);\n\n    return connect(\n        makeMapStateToProps(packets, packets.filter(b => b.mapStateToProps)),\n        makeMapDispatchToProps(packets, packets.filter(b => b.mapDispatchToProps)),\n        makeMergeProps(mapPacketsToProps, mergeProps),\n        options\n    );\n};\n"],"names":["memoizeFirstMapStateToProps","selector","executeContextSelectors","firstState","firstProps","firstValue","firstContext","inner","state","props","checkPacketDescriptor","packetDescriptor","name","calledFnName","argExpectation","TypeError","actions","checkPacketMapAndGetNames","packetMap","Array","isArray","packetNames","Object","keys","length","selectorExecutor","selectors","map","internalPack","PacketMaker","contextSelectors","hasContext","minimumSelectorsExpected","Error","mapStateToProps","mapDispatchToProps","dispatch","bindActionCreators","defineProperty","writable","enumerable","configurable","value","pack","packAll","reduce","o","nonUniqueFilter","i","values","lastIndexOf","spreadAllSafe","fallbackName","nonUniqueProps","a","v","concat","filter","join","assign","defaultMapPacketsToProps","defaultMergeProps","packetProps","ownProps","noop","anyContext","packets","prop","some","b","makeMergePropsOnePacket","mapPacketsToProps","mergeProps","undefined","stateProps","dispatchProps","consumeOnePacket","packet","options","connect","makeMapStateToProps","withState","mapStateToPropsList","mapper","makeMapDispatchToProps","withDispatch","makeMergeProps","propsByPacket","packetState","packetDispatch","consume"],"mappings":"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"}